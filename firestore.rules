rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    function isadmin(){
      return request.auth.token.admin == true || /databases/$(database)/documents/Members/$(request.auth.uid).data.admin == true;
    }
    function isUpdatingField(fieldName) {
      return (!(fieldName in resource.data) && fieldName in request.resource.data) || resource.data[fieldName] != request.resource.data[fieldName];
    }
    match /Members/{id}{
      allow create: if true;
      allow update: if ((request.auth.uid == request.resource.data.id) && !isUpdatingField("admin")) ||
      isadmin();
      allow read: if request.auth != null && ((request.auth.uid == request.resource.data.id) || isadmin());
    }
    match /Events/{events}{
    	allow write: if isadmin();
      allow read: if request.auth != null;
    }
    match /Event/{event}{
    	allow write: if isadmin();
      allow read;
    }
    match /LoginFields/{fields}{
    	allow write: if false;
      allow read;
    }
    match /Posts/{post}{
    	allow read: if request.auth != null;
      allow create: if (request.auth != null && request.auth.uid == request.resource.data.id);
      allow update: if request.auth != null && (request.auth.uid == post.id || isadmin());
    }
    match /Resources/{resource}{
    	allow read;
      allow write: if (request.auth != null && isadmin());
    }
  }
}
